ржЦрзБржм ржнрж╛рж▓рзЛ ржкрзНрж░рж╢рзНржи! ржПржЗ ржжрзБржЗржЯрж╛ `getMap()` ржлрж╛ржВрж╢ржирзЗрж░ ржоржзрзНржпрзЗ ржкрж╛рж░рзНржержХрзНржпржЯрж╛ ржжрзЗржЦрждрзЗ ржПржХржЗрж░ржХржо рж▓рж╛ржЧрж▓рзЗржУ, **рждрж╛ржжрзЗрж░ ржмрзНржпржмрж╣рж╛рж░рж┐ржХ ржЖржЪрж░ржг ржПржХрзЗржмрж╛рж░рзЗ ржЖрж▓рж╛ржжрж╛**ред ржирж┐ржЪрзЗ ржмрж╛ржВрж▓рж╛рзЯ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░ржЫрж┐ред

---

## тЬи ржкрзНрж░ржержоржЯрж┐:

```js
function getMap() {
  if (imageRef.current !== null) {
    return (imageRef.current = new Map());
  }
  return imageRef.current;
}
```

### ЁЯФН рж╕ржорж╕рзНржпрж╛ ржХрзЛржерж╛рзЯ?

- `imageRef.current !== null` тЖТ ржпржжрж┐ `imageRef.current` **already set** ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ **рждрзБржорж┐ ржЖржмрж╛рж░ржУ ржирждрзБржи `Map()` ржмрж╛ржирж┐рзЯрзЗ ржжрж┐ржЪрзНржЫрзЛ**ред
- ржЕрж░рзНржерж╛рзО: **ржкрзБрж░рзЛржирзЛ Map ржорзБржЫрзЗ ржЧрж┐рзЯрзЗ** ржирждрзБржи ржлрж╛ржБржХрж╛ Map рждрзИрж░рж┐ рж╣ржЪрзНржЫрзЗ ржмрж╛рж░ржмрж╛рж░ред

### ЁЯзи ржПрж░ ржлрж▓:

- рждрзБржорж┐ ржЖржЧрзЗрж░ Map-ржП ржпрж╛ ржХрж┐ржЫрзБ `set` ржХрж░рзЗржЫрж┐рж▓рзЗ, рж╕ржм рж╣рж╛рж░рж┐рзЯрзЗ ржпрж╛ржмрзЗред
- ржкрзНрж░рждрж┐ржмрж╛рж░ `getMap()` ржХрж▓ ржХрж░рж▓рзЗ ржкрзБрж░ржирзЛ ржбрзЗржЯрж╛ ржорзБржЫрзЗ ржпрж╛ржмрзЗред

---

## тЬЕ ржжрзНржмрж┐рждрзАрзЯржЯрж┐ (рж╕ржарж┐ржХ ржУ standard approach):

```js
function getMap() {
  if (!imageRef.current) {
    imageRef.current = new Map();
  }
  return imageRef.current;
}
```

### тЬЕ ржПржЯрж┐ ржХрзА ржХрж░рзЗ?

- ржПржЯрж╛ **рж╢рзБржзрзБ ржПржХржмрж╛рж░ржЗ** `Map()` рждрзИрж░рж┐ ржХрж░рзЗ ржпржЦржи `imageRef.current` ржлрж╛ржБржХрж╛ ржерж╛ржХрзЗред
- ржПрж░ржкрж░ ржпрждржмрж╛рж░ `getMap()` ржХрж▓ рж╣рзЯ, ржЖржЧрзЗрж░ ржПржХржЗ Map ржлрзЗрж░ржд ржжрзЗрзЯред

### ЁЯТб ржПржЗ ржХрж╛рж░ржгрзЗржЗ ржХрж╛ржЬ ржХрж░рзЗ:

- Map-ржП рж░рж╛ржЦрж╛ DOM node ржЧрзБрж▓рзЛ ржмржЬрж╛рзЯ ржерж╛ржХрзЗред
- рж╕рзНржХрзНрж░рж▓ ржХрж░рж╛рж░ рж╕ржорзЯ рж╕ржарж┐ржХ DOM node ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

---

## ЁЯУК рждрзБрж▓ржирж╛ ржЯрзЗржмрж┐рж▓:

| ржжрж┐ржХ                    | ржкрзНрж░ржержоржЯрж╛ (`imageRef.current !== null`)           | ржжрзНржмрж┐рждрзАрзЯржЯрж╛ (`!imageRef.current`)           |
| ---------------------- | ----------------------------------------------- | ----------------------------------------- |
| Map рждрзИрж░рж┐ рж╣рзЯ ржХржЦржи?       | ржпржЦржи `imageRef.current` ржЖржЧрзЗ ржерзЗржХрзЗржЗ ржЖржЫрзЗ (тЭМ ржЙрж▓рзНржЯрзЛ) | ржпржЦржи `imageRef.current` ржлрж╛ржБржХрж╛ (тЬЕ ржарж┐ржХржнрж╛ржмрзЗ) |
| ржкрзБрж░ржирзЛ Map ржмрзЗржБржЪрзЗ ржерж╛ржХрзЗ?  | ржирж╛, ржкрзНрж░рждрж┐ржмрж╛рж░ ржирждрзБржи рж╣рзЯ                            | рж╣рзНржпрж╛ржБ, ржПржХржмрж╛рж░ рждрзИрж░рж┐ рж╣рж▓рзЗ ржПржХржЗржЯрж╛ ржерж╛ржХрзЗ          |
| рж╕рзНржХрзНрж░рж▓ ржлрж╛ржВрж╢ржи ржХрж╛ржЬ ржХрж░ржмрзЗ? | ржирж╛                                              | рж╣рзНржпрж╛ржБ                                     |
| ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕           | ржЦрж╛рж░рж╛ржк (ржкрзНрж░рждрж┐ржмрж╛рж░ ржирждрзБржи Map)                       | ржнрж╛рж▓рзЛ (ржПржХ Map ржжрж┐рзЯрзЗ ржХрж╛ржЬ рж╢рзЗрж╖)                |

---

## тЬЕ Bottom line:

> рждрзЛржорж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ `imageRef.current !== null` ржЪрзЗржХржЯрж╛ **ржПржХржжржо ржЙрж▓рзНржЯрзЛржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ**ред ржПрж░ ржХрж╛рж░ржгрзЗ ржкрзБрж░рзЛржирзЛ `Map()` ржкрзНрж░рждрж┐ржмрж╛рж░ ржирждрзБржи рж╣рзЯрзЗ ржпрж╛ржЪрзНржЫрзЗред

тЬЕ ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржЪрж╛ржЗрж▓рзЗ, ржПржЗржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ:

```js
if (!imageRef.current) {
  imageRef.current = new Map();
}
```

рждрзЛржорж╛рж░ ржХрзЛржбрзЗ ржЖржорж┐ ржЪрж╛ржЗрж▓рзЗ ржПржЯрж╛ ржмрж╕рж┐рзЯрзЗ ржжрж┐рзЯрзЗ ржкрзБрж░рзЛржЯрж╛ ржЖржмрж╛рж░ рж╕рж╛ржЬрж┐рзЯрзЗ ржжрж┐рждрзЗ ржкрж╛рж░рж┐ред ржжрж░ржХрж╛рж░ рж╣рж▓рзЗ ржмрж▓рзЛ!
