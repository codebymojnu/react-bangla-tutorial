# ржЖржкржирж╛рж░ рж╣рзЯрждрзЛ useEffect-ржПрж░ ржжрж░ржХрж╛рж░ ржирзЗржЗ

`useEffect` рж╣ржЪрзНржЫрзЗ React-ржПрж░ ржирж┐рзЯржоржХрж╛ржирзБржи (paradigm) ржерзЗржХрзЗ ржмрзЗрж░ рж╣рзЯрзЗ ржмрж╛ржЗрж░рзЗрж░ ржХрзЛржирзЛ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ (ржпрзЗржоржи: API, DOM, ржерж╛рж░рзНржб-ржкрж╛рж░рзНржЯрж┐ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐) рж╕рж╛ржерзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рж╛рж░ ржжрж░ржЬрж╛ред ржХрж┐ржирзНрждрзБ ржпржжрж┐ React ржХржорзНржкрзЛржирзЗржирзНржЯрзЗрж░ ржнрж┐рждрж░рзЗ ржерж╛ржХрж╛ props ржмрж╛ state ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржнрж┐рждрзНрждрж┐рждрзЗ ржХрж┐ржЫрзБ ржХрж░рж╛рж░ ржжрж░ржХрж╛рж░ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ `useEffect` ржПрж░ ржкрзНрж░тАНрзЯрзЛржЬржи ржирзЗржЗред ржЕржкрзНрж░рзЯрзЛржЬржирзАрзЯ `useEffect` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржХрзЛржб ржЬржЯрж┐рж▓ рж╣рзЯ, ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржХржорзЗ ржпрж╛рзЯ, ржПржмржВ ржмрж╛ржЧ рж╣ржУрзЯрж╛рж░ ржЭрзБржБржХрж┐ ржмрж╛рзЬрзЗред

- ржХржЦржи ржПржмржВ ржХрзЗржи ржЕржкрзНрж░рзЯрзЛржЬржирзАрзЯ `useEffect` ржмрж╛ржж ржжрж┐рждрзЗ рж╣ржмрзЗ
- ржХрж┐ржнрж╛ржмрзЗ ржЦрж░ржЪрж╕рж╛ржкрзЗржХрзНрж╖ (expensive) ржЧржгржирж╛ Effect ржЫрж╛рзЬрж╛ ржХрзНржпрж╛рж╢ ржХрж░ржмрзЗржи
- ржХрж┐ржнрж╛ржмрзЗ state reset ржмрж╛ ржЖржкржбрзЗржЯ ржХрж░ржмрзЗржи `useEffect` ржЫрж╛рзЬрж╛
- ржХрж┐ржнрж╛ржмрзЗ ржПржХрж╛ржзрж┐ржХ ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░рзЗ рж▓ржЬрж┐ржХ рж╢рзЗрзЯрж╛рж░ ржХрж░ржмрзЗржи
- ржХрзЛржи рж▓ржЬрж┐ржХ ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░рзЗ рж░рж╛ржЦрж╛ ржЙржЪрж┐ржд
- ржХрж┐ржнрж╛ржмрзЗ ржкрзНржпрж╛рж░рзЗржирзНржЯ ржХржорзНржкрзЛржирзЗржирзНржЯржХрзЗ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржЦржмрж░ ржжрзЗржмрзЗржи

---

## ржХрж┐ржнрж╛ржмрзЗ ржЕржкрзНрж░рзЯрзЛржЬржирзАрзЯ useEffect ржмрж╛ржж ржжрж┐ржмрзЗржи {/* how-to-remove-unnecessary-effects */}

React-ржП ржжрзБржЗржЯрж┐ рж╕рж╛ржзрж╛рж░ржг ржХрзНрж╖рзЗрждрзНрж░рзЗ `useEffect` ржирж╛ рж▓рж┐ржЦрзЗржУ ржЖржкржирж╛рж░ ржХрж╛ржЬ рж╣рзЯрзЗ ржпрж╛ржмрзЗ:

---

### тЬЕ ржЖржкржирж┐ ржпржжрж┐ ржбрж╛ржЯрж╛ ржлрж┐рж▓рзНржЯрж╛рж░/ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ ржжрзЗржЦрж╛рждрзЗ ржЪрж╛ржи

**ржнрзБрж▓ ржкржжрзНржзрждрж┐ (ржпрзЗржЦрж╛ржирзЗ ржЕржирзЗржХрзЗ `useEffect` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ):**

```jsx
const [filteredList, setFilteredList] = useState([]);

useEffect(() => {
  setFilteredList(list.filter((item) => item.active));
}, [list]);
```

**ржнрж╛рж▓ ржкржжрзНржзрждрж┐ (Effect ржЫрж╛рзЬрж╛):**

```jsx
const filteredList = list.filter((item) => item.active);
```

ЁЯУМ **ржХрзЗржи?**
React ржпржЦржи рж░рзЗржирзНржбрж╛рж░ ржХрж░рзЗ, рждржЦржи рж╕рзЗ `filteredList` ржЖржмрж╛рж░ рж╣рж┐рж╕рж╛ржм ржХрж░рзЗ ржирзЗрзЯред ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ `useEffect` ржжрж┐рзЯрзЗ state рж╕рзЗржЯ ржХрж░рж▓рзЗ React ржЕрждрж┐рж░рж┐ржХрзНржд рж░рзЗржирзНржбрж╛рж░ ржХрж░рзЗред рждрж╛ржЗ рж╢рзБржзрзБ ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржп ржлрж┐рж▓рзНржЯрж╛рж░ ржХрж░рж▓рзЗ, рж╕рж░рж╛рж╕рж░рж┐ ржЙржкрж░рзЗрж░ ржорждрзЛ рж▓рж┐ржЦрж▓рзЗржЗ ржпржерзЗрж╖рзНржЯред

---

### тЬЕ ржЖржкржирж┐ ржпржжрж┐ ржЗржЙржЬрж╛рж░рзЗрж░ event рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рждрзЗ ржЪрж╛ржи

**ржнрзБрж▓ ржкржжрзНржзрждрж┐ (Effect ржжрж┐рзЯрзЗ event ржзрж░рзЗ):**

```jsx
useEffect(() => {
  if (hasBought) {
    fetch("/api/buy");
    alert("Thanks!");
  }
}, [hasBought]);
```

**ржнрж╛рж▓ ржкржжрзНржзрждрж┐ (ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░рзЗ рж╕рж░рж╛рж╕рж░рж┐ ржХрж╛ржЬ):**

```jsx
function handleBuyClick() {
  fetch("/api/buy");
  alert("Thanks!");
}
```

ЁЯУМ **ржХрзЗржи?**
ржЗржЙржЬрж╛рж░ ржХржЦржи ржХрж┐ ржХрж░рзЗржЫрзЗ рж╕рзЗржЯрж╛ ржЖржкржирж┐ ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░рзЗрж░ ржнрж┐рждрж░рзЗ ржЬрж╛ржирзЗржиред ржХрж┐ржирзНрждрзБ `useEffect` рждржЦржи ржЪрж╛рж▓рзБ рж╣рзЯ ржпржЦржи ржХрж╛ржЬ рж╢рзЗрж╖, ржЕржержЪ ржХрзА рж╣рзЯрзЗржЫрзЗ рж╕рзЗржЯрж╛ ржмрзЛржЭрж╛рж░ ржЙржкрж╛рзЯ ржерж╛ржХрзЗ ржирж╛ред рждрж╛ржЗ ржЗржнрзЗржирзНржЯрзЗрж░ ржХрж╛ржЬ ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░рзЗржЗ ржХрж░рж╛ рж╕ржмржЪрзЗрзЯрзЗ ржнрж╛рж▓рзЛред

---

### ЁЯзк рждрж╛рж╣рж▓рзЗ ржХржЦржи useEffect ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЛ?

ржЖржкржирж┐ ржпржжрж┐ ржмрж╛ржЗрж░рзЗрж░ рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ рж╕рж╛ржерзЗ React state ржмрж╛ UI рж╕рж┐ржЩрзНржХ ржХрж░рждрзЗ ржЪрж╛ржи, рждржЦржи `useEffect` ржжрж░ржХрж╛рж░ рж╣рзЯред

ржЙржжрж╛рж╣рж░ржг:

```jsx
useEffect(() => {
  const controller = new AbortController();
  fetch("/api/products", { signal: controller.signal })
    .then((res) => res.json())
    .then((data) => setProducts(data));
  return () => controller.abort();
}, []);
```

ЁЯУМ **ржПржЯрж╛ ржжрж░ржХрж╛рж░ рж╣рзЯ ржпржЦржи:**

- API ржерзЗржХрзЗ ржбрзЗржЯрж╛ ржЖржирждрзЗ рж╣рзЯ
- DOM ржорзНржпрж╛ржирж┐ржкрзБрж▓рзЗрж╢ржи ржХрж░рждрзЗ рж╣рзЯ
- WebSocket ржмрж╛ localStorage ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣рзЯ
- ржХрзЛржирзЛ ржерж╛рж░рзНржб-ржкрж╛рж░рзНржЯрж┐ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ React ржПрж░ рж╕рж╛ржерзЗ ржпрзБржХрзНржд ржХрж░рждрзЗ рж╣рзЯ

---

ЁЯФЪ **рж╢рзЗрж╖ ржХржерж╛:**

| ржЖржкржирж┐ ржХрзА ржХрж░рждрзЗ ржЪрж╛ржи?                       | useEffect ржжрж░ржХрж╛рж░? |
| --------------------------------------- | ---------------- |
| ржбрж╛ржЯрж╛ рж╕рж╛ржЬрж╛ржирзЛ (filter/sort/map)           | тЭМ ржирж╛            |
| ржЗржЙржЬрж╛рж░рзЗрж░ ржХрзНрж▓рж┐ржХ/ржЗржиржкрзБржЯ рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рж╛        | тЭМ ржирж╛            |
| API ржХрж▓ / DOM ржкрж░рж┐ржмрж░рзНрждржи / External Widget | тЬЕ рж╣рзНржпрж╛ржБ         |

---

ржПржЦржи ржЖржкржирж┐ ржмрзБржЭрзЗ ржпрж╛ржмрзЗржи, рж╕ржм ржХрж┐ржЫрзБрждрзЗржЗ `useEffect` ржжрж░ржХрж╛рж░ рж╣рзЯ ржирж╛ред ржХрзЛржб рж╕рж╣ржЬ ржУ ржкрж╛рж░ржлрж░рзНржорзЗржирзНржЯ рж░рж╛ржЦрждрзЗ рж╣рж▓рзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ ржжрж░ржХрж╛рж░ рж╣рж▓рзЗ `useEffect` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

ржирж┐ржЪрзЗ ржЖржорж┐ ржЖржкржирж╛рж░ ржжрзЗржУрзЯрж╛ рж╕рзНржЯрж╛ржЗрж▓ ржЕржирзБрж╕рж░ржг ржХрж░рзЗ рж╕рж╣ржЬ ржмрж╛ржВрж▓рж╛рзЯ, ржЯрж┐ржЙржЯрзЛрж░рж┐рзЯрж╛рж▓ ржЖржХрж╛рж░рзЗ ржЕржирзБржмрж╛ржж ржХрж░рзЗ ржжрж┐рж▓рж╛ржо:

---

### props ржмрж╛ state-ржПрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ state ржЖржкржбрзЗржЯ {/* updating-state-based-on-props-or-state */}

ржзрж░рзБржи, ржЖржкржирж╛рж░ ржПржХржЯрж┐ ржХржорзНржкрзЛржирзЗржирзНржЯ ржЖржЫрзЗ ржпрзЗржЦрж╛ржирзЗ ржжрзБржЯрж┐ state рж░рзЯрзЗржЫрзЗ: `firstName` ржПржмржВ `lastName`ред ржЖржкржирж┐ ржПржЗ ржжрзБржЗржЯрж┐ ржорж┐рж▓рж┐рзЯрзЗ `fullName` рждрзИрж░рж┐ ржХрж░рждрзЗ ржЪрж╛ржиред ржЖрж░ ржЪрж╛ржЗржЫрзЗржи, ржпржЦржиржЗ `firstName` ржмрж╛ `lastName` ржмржжрж▓рж╛ржмрзЗ, `fullName` ржирж┐ржЬрзЗ ржерзЗржХрзЗржЗ ржЖржкржбрзЗржЯ рж╣рзЯрзЗ ржпрж╛ржХред

рждржЦржи рж╣рзЯрждрзЛ ржЖржкржирж┐ ржПржЗржнрж╛ржмрзЗ `fullName` ржХрзЗ ржЖрж▓рж╛ржжрж╛ state рж╣рж┐рж╕рзЗржмрзЗ рж░рзЗржЦрзЗ `useEffect` ржжрж┐рзЯрзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржХржерж╛ ржнрж╛ржмржмрзЗржи:

```js {5-9}
function Form() {
  const [firstName, setFirstName] = useState("Taylor");
  const [lastName, setLastName] = useState("Swift");

  // ЁЯФ┤ ржнрзБрж▓ ржкржжрзНржзрждрж┐: ржмрж╛рзЬрждрж┐ state ржПржмржВ ржЕржкрзНрж░рзЯрзЛржЬржирзАрзЯ Effect
  const [fullName, setFullName] = useState("");
  useEffect(() => {
    setFullName(firstName + " " + lastName);
  }, [firstName, lastName]);
  // ...
}
```

ржПржЗ ржкржжрзНржзрждрж┐рждрзЗ ржХрж╛ржЬ unnecessary ржЬржЯрж┐рж▓ рж╣рзЯрзЗ ржпрж╛рзЯред ржкрзНрж░ржержорзЗ `fullName` ржкрзБрж░ржирзЛ (stale) ржорж╛ржи ржирж┐рзЯрзЗ рж░рзЗржирзНржбрж╛рж░ рж╣рзЯ, рждрж╛рж░ржкрж░ ржЖржмрж╛рж░ ржирждрзБржи ржорж╛ржи ржжрж┐рзЯрзЗ рж░рзЗржирзНржбрж╛рж░ рж╣рзЯ тАФ ржорж╛ржирзЗ ржПржХрзНрж╕ржЯрзНрж░рж╛ рж░рзЗржирзНржбрж╛рж░рж┐ржВ!

ржПрж░ ржЪрзЗрзЯрзЗ рж╕рж╣ржЬ ржЙржкрж╛рзЯ рж╣рж▓рзЛ: `fullName` ржХрзЗ рж╕рж░рж╛рж╕рж░рж┐ рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ рж╣рж┐рж╕рж╛ржм ржХрж░рж╛:

```js {4-5}
function Form() {
  const [firstName, setFirstName] = useState("Taylor");
  const [lastName, setLastName] = useState("Swift");
  // тЬЕ ржнрж╛рж▓рзЛ ржкржжрзНржзрждрж┐: рж╕рж░рж╛рж╕рж░рж┐ рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ рж╣рж┐рж╕рж╛ржм ржХрж░рж╛
  const fullName = firstName + " " + lastName;
  // ...
}
```

ЁЯУМ **ржпржЦржи ржХрж┐ржЫрзБ ржЖржкржирж┐ рж╕рж╣ржЬрзЗржЗ props ржмрж╛ state ржерзЗржХрзЗ рж╣рж┐рж╕рж╛ржм ржХрж░рждрзЗ ржкрж╛рж░рзЗржи, рждржЦржи рж╕рзЗржЯрж╛ржХрзЗ state-ржП рж░рж╛ржЦрж╛рж░ ржжрж░ржХрж╛рж░ ржирзЗржЗред** ржмрж░ржВ рж╕рж░рж╛рж╕рж░рж┐ рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ рж╣рж┐рж╕рж╛ржм ржХрж░рзЗ ржлрзЗрж▓рзБржиред

ржПрж░ ржлрж▓рзЗ ржЖржкржирж┐ ржкрж╛ржмрзЗржи:

- тЬЕ ржнрж╛рж▓рзЛ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ (ржХрж╛рж░ржг ржмрж╛рзЬрждрж┐ рж░рзЗржирзНржбрж╛рж░ рж╣ржмрзЗ ржирж╛)
- тЬЕ ржХржо ржХрзЛржб (ржмрж╛рзЬрждрж┐ state ржУ `useEffect` ржмрж╛ржж)
- тЬЕ ржХржо ржмрж╛ржЧ (state ржЧрзБрж▓рзЛрж░ ржоржзрзНржпрзЗ ржнрзБрж▓ржнрж╛ржмрзЗ mismatch рж╣ржУрзЯрж╛рж░ ржЭрзБржБржХрж┐ ржХржо)

ржпржжрж┐ ржПржЗ ржХржирж╕рзЗржкрзНржЯржЯрж╛ ржирждрзБржи рж▓рж╛ржЧрзЗ, рждрж╛рж╣рж▓рзЗ ["Thinking in React"](https://react.dev/learn/thinking-in-react#step-3-find-the-minimal-but-complete-representation-of-ui-state) ржЧрж╛ржЗржбржЯрж┐ ржжрзЗржЦрж▓рзЗ ржкрж░рж┐рж╖рзНржХрж╛рж░ ржзрж╛рж░ржгрж╛ ржкрж╛ржмрзЗржи ржХрзЛржи ржЬрж┐ржирж┐рж╕ржЧрзБрж▓рзЛ state-ржП рж░рж╛ржЦрж╛ ржЙржЪрж┐ржд ржЖрж░ ржХрзЛржиржЧрзБрж▓рзЛ ржирзЯред

---

ржирж┐ржЪрзЗ ржЖржорж┐ рж╕рж╣ржЬ ржнрж╛рж╖рж╛рзЯ, ржЯрж┐ржЙржЯрзЛрж░рж┐рзЯрж╛рж▓ рж╕рзНржЯрж╛ржЗрж▓рзЗ ржмрж╛ржВрж▓рж╛рзЯ ржЕржирзБржмрж╛ржж ржХрж░рж▓рж╛ржо:

---

### ржпржЦржи ржХрзЛржирзЛ prop ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рзЯ, рждржЦржи ржХрж┐ржЫрзБ state ржЕрзНржпрж╛ржбржЬрж╛рж╕рзНржЯ ржХрж░рж╛ {/* adjusting-some-state-when-a-prop-changes */}

ржХржЦржирзЛ ржХржЦржирзЛ ржЖржкржирж┐ ржЪрж╛ржЪрзНржЫрзЗржи ржпрзЗ, ржХрзЛржирзЛ prop ржкрж░рж┐ржмрж░рзНрждрж┐ржд рж╣рж▓рзЗ state-ржПрж░ ржХрж┐ржЫрзБ ржЕржВрж╢ рж░рж┐рж╕рзЗржЯ ржмрж╛ ржкрж░рж┐ржмрж░рзНрждржи рж╣рзЛржХ тАФ ржХрж┐ржирзНрждрзБ ржкрзБрж░рзЛржЯрж╛ ржирзЯред

ржзрж░рзБржи ржПржЗ `List` ржХржорзНржкрзЛржирзЗржирзНржЯржЯрж┐ `items` ржирж╛ржорзЗрж░ ржПржХржЯрж┐ prop ржирж┐ржЪрзНржЫрзЗ ржПржмржВ `selection` ржирж╛ржорзЗ ржПржХржЯрж┐ state рж░рж╛ржЦржЫрзЗ, ржпрзЗржЯрж╛ ржирж┐рж░рзНржмрж╛ржЪрж┐ржд ржЖржЗржЯрзЗржо ржЯрзНрж░рзНржпрж╛ржХ ржХрж░рзЗред ржЖржкржирж┐ ржЪрж╛ржЗржЫрзЗржи, ржпржЦржиржЗ `items` ржирждрзБржи ржХрзЛржирзЛ ржЕрзНржпрж╛рж░рзЗ ржкрж╛рзЯ, рждржЦржи `selection` ржпрзЗржи `null` рж╣рзЯрзЗ ржпрж╛рзЯред

ржЖржкржирж┐ рж╣рзЯрждрзЛ ржПржоржи ржХрзЛржб рж▓рж┐ржЦрждрзЗ ржкрж╛рж░рзЗржи:

```js {5-8}
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // ЁЯФ┤ ржнрзБрж▓: prop ржкрж░рж┐ржмрж░рзНрждржирзЗ Effect ржжрж┐рзЯрзЗ state ржЖржкржбрзЗржЯ ржХрж░рж╛
  useEffect(() => {
    setSelection(null);
  }, [items]);
  // ...
}
```

тЭМ ржПржЗ ржкржжрзНржзрждрж┐ржУ ржкрж╛рж░ржлрзЗржХрзНржЯ ржирзЯред ржХрж╛рж░ржг ржПржЦрж╛ржирзЗ ржпрж╛ рж╣ржЪрзНржЫрзЗ:

1. `items` ржмржжрж▓рж╛ржирзЛрж░ ржкрж░ `List` ржПржмржВ ржПрж░ ржЪрж╛ржЗрж▓рзНржб ржХржорзНржкрзЛржирзЗржирзНржЯржЧрзБрж▓рзЛ ржкрзБрж░ржирзЛ `selection` ржжрж┐рзЯрзЗ рж░рзЗржирзНржбрж╛рж░ рж╣рзЯред
2. рждрж╛рж░ржкрж░ React DOM ржЖржкржбрзЗржЯ ржХрж░рзЗ ржПржмржВ `useEffect` ржЪрж╛рж▓рж╛рзЯред
3. ржПрж░ржкрж░ `setSelection(null)` ржжрж┐рзЯрзЗ ржЖржмрж╛рж░ рж░рзЗржирзНржбрж╛рж░ рж╢рзБрж░рзБ рж╣рзЯред

ржЕрж░рзНржерж╛рзО ржПржХрзНрж╕ржЯрзНрж░рж╛ ржПржХ рж░рзЗржирзНржбрж╛рж░рж┐ржВ рж╕рж╛ржЗржХрзЗрж▓ рж╣рзЯрзЗ ржпрж╛рзЯред

тЬЕ ржПржЗ рж╕ржорж╕рзНржпрж╛рж░ ржнрж╛рж▓рзЛ рж╕ржорж╛ржзрж╛ржи рж╣рж▓рзЛ: `useEffect` ржмрж╛ржж ржжрж┐рзЯрзЗ рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ рж╕рж░рж╛рж╕рж░рж┐ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ ржХрж░рж╛:

```js {5-11}
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // тЬЕ ржнрж╛рж▓рзЛ: рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯржЗ ржЪрзЗржХ ржУ ржЖржкржбрзЗржЯ
  const [prevItems, setPrevItems] = useState(items);
  if (items !== prevItems) {
    setPrevItems(items);
    setSelection(null);
  }
  // ...
}
```

ржПржЗржнрж╛ржмрзЗ [ржЖржЧрзЗрж░ рж░рзЗржирзНржбрж╛рж░рзЗрж░ рждржерзНржп рж╕ржВрж░ржХрзНрж╖ржг](https://react.dev/reference/react/useState#storing-information-from-previous-renders) ржХрж░рзЗ рж╕рзНржЯрзЗржЯ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛ ржПржХржЯрзБ ржХржарж┐ржи ржоржирзЗ рж╣рждрзЗ ржкрж╛рж░рзЗ, ржХрж┐ржирзНрждрзБ `useEffect` ржжрж┐рзЯрзЗ ржПржХржЗ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржЪрзЗрзЯрзЗ ржПржЯрж╛ ржнрж╛рж▓рзЛред

ржЙржкрж░рзЗрж░ ржХрзЛржбрзЗ, `setSelection(null)` рж╕рж░рж╛рж╕рж░рж┐ рж░рзЗржирзНржбрж╛рж░рзЗрж░ ржнрж┐рждрж░рзЗржЗ рж╣ржЪрзНржЫрзЗред ржПрж░ ржлрж▓рзЗ React ржЕржмрж┐рж▓ржорзНржмрзЗ рж░рзЗржирзНржбрж╛рж░ рж░рж┐ржЬрзЗржХрзНржЯ ржХрж░рзЗ ржЖржмрж╛рж░ ржирждрзБржи ржХрж░рзЗ рж░рзЗржирзНржбрж╛рж░ рж╢рзБрж░рзБ ржХрж░рзЗ тАФ ржХрж┐ржирзНрждрзБ ржПржЦржирзЛ DOM ржЖржкржбрзЗржЯ ржХрж░рзЗржирж┐ ржмрж╛ ржЪрж╛ржЗрж▓рзНржб ржХржорзНржкрзЛржирзЗржирзНржЯ рж░рзЗржирзНржбрж╛рж░ ржХрж░рзЗржирж┐ред ржлрж▓рзЗ ржкрзБрж░ржирзЛ `selection` ржжрж┐рзЯрзЗ DOM-ржП ржХрж┐ржЫрзБ ржжрзЗржЦрж╛ржирзЛрж░ рж╕рзБржпрзЛржЧржЗ ржерж╛ржХрзЗ ржирж╛ред

тЪая╕П ржоржирзЗ рж░рж╛ржЦржмрзЗржи: рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ рж╢рзБржзрзБ рж╕рзЗржЗ ржПржХржЗ ржХржорзНржкрзЛржирзЗржирзНржЯрзЗрж░ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред ржЕржирзНржп ржХржорзНржкрзЛржирзЗржирзНржЯрзЗрж░ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржЧрзЗрж▓рзЗ React ржПрж░рж░ ржжрзЗржЦрж╛ржмрзЗред

ЁЯФБ `items !== prevItems` ржПржЗ ржХржирзНржбрж┐рж╢ржиржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржЬрж░рзБрж░рж┐ тАФ ржирж╛ рж╣рж▓рзЗ ржЗржиржлрж┐ржирж┐ржЯ рж▓рзБржкрзЗ ржкрзЬржмрзЗржиред

тЫФ ржпрзЗржХрзЛржирзЛ DOM ржорзНржпрж╛ржирж┐ржкрзБрж▓рзЗрж╢ржи ржмрж╛ ржЯрж╛ржЗржорж╛рж░ рж╕рзЗржЯ ржХрж░рж╛рж░ ржорждрзЛ ржХрж╛ржЬ рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ ржХрж░рж╛ ржпрж╛ржмрзЗ ржирж╛ тАФ рж╕рзЗржЧрзБрж▓рзЛрж░ ржЬрж╛рзЯржЧрж╛ рж╣рж▓рзЛ `useEffect` ржмрж╛ ржЗржнрзЗржирзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░ред

---

### тЬЕ рж╕ржмржЪрзЗрзЯрзЗ ржнрж╛рж▓рзЛ рж╕ржорж╛ржзрж╛ржи: рж╕рзНржЯрзЗржЯ ржПржбржЬрж╛рж╕рзНржЯ ржХрж░рж╛рж░ ржжрж░ржХрж╛рж░ржЗ ржирзЗржЗ

**ржпржжрж┐ржУ ржПржЗ ржкрзНржпрж╛ржЯрж╛рж░рзНржи `useEffect`-ржПрж░ ржЪрзЗрзЯрзЗ ржнрж╛рж▓рзЛ, рждрж╛рж░ржкрж░ржУ ржмрзЗрж╢рж┐рж░ржнрж╛ржЧ ржХрзНрж╖рзЗрждрзНрж░рзЗ ржЖржкржирж╛ржХрзЗ ржПржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗ ржирж╛ред** ржХрж╛рж░ржг props ржмрж╛ state-ржПрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ рж╕рзНржЯрзЗржЯ ржЖржкржбрзЗржЯ ржХрж░рж╛ ржорж╛ржирзЗ рж╣ржЪрзНржЫрзЗ ржбрзЗржЯрж╛ ржлрзНрж▓рзЛ ржЖрж░ржУ ржЬржЯрж┐рж▓ ржХрж░рж╛, ржпрзЗржЯрж╛ ржбрж┐ржмрж╛ржЧ ржХрж░рж╛ ржХрж╖рзНржЯржХрж░ред

рждрж╛ржЗ ржкрзНрж░ржержорзЗ ржжрзЗржЦрзБржи ржЖржкржирж┐ ржХрж┐ ржкрж╛рж░рждрзЗржи:

- [ржХржорзНржкрзЛржирзЗржирзНржЯржХрзЗ `key` ржжрж┐рзЯрзЗ ржкрзБрж░рзЛ рж░рж┐рж╕рзЗржЯ ржХрж░рждрзЗ](#resetting-all-state-when-a-prop-changes), ржмрж╛
- [рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯржЗ рж╕ржм рж╣рж┐рж╕рж╛ржм ржХрж░рждрзЗ](#updating-state-based-on-props-or-state)?

ржЙржжрж╛рж╣рж░ржг:

`selection` рж╕рзНржЯрзЗржЯ рж░рзЗржЦрзЗ ржПржмржВ ржмрж╛рж░ржмрж╛рж░ рж░рж┐рж╕рзЗржЯ ржирж╛ ржХрж░рзЗ, ржмрж░ржВ `selectedId` рж░рзЗржЦрзЗ рж╕рж░рж╛рж╕рж░рж┐ рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ `selection` рж╣рж┐рж╕рж╛ржм ржХрж░рж╛ ржпрж╛рзЯ:

```js {3-5}
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selectedId, setSelectedId] = useState(null);
  // тЬЕ рж╢рзНрж░рзЗрж╖рзНржа ржкржжрзНржзрждрж┐: рж░рзЗржирзНржбрж╛рж░рзЗрж░ рж╕ржорзЯ рж╣рж┐рж╕рж╛ржм
  const selection = items.find((item) => item.id === selectedId) ?? null;
  // ...
}
```

ржПржЦржи ржЖрж░ state "reset" ржХрж░рж╛рж░ ржжрж░ржХрж╛рж░ ржирзЗржЗред ржпржжрж┐ `selectedId`-рж░ рж╕рж╛ржерзЗ ржорж┐рж▓ ржерж╛ржХрж╛ ржЖржЗржЯрзЗржо `items`-ржПрж░ ржоржзрзНржпрзЗ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ рж╕рзЗржЯрж╛ ржерж╛ржХржмрзЗ ржирж┐рж░рзНржмрж╛ржЪрж┐рждред ржЖрж░ ржирж╛ ржерж╛ржХрж▓рзЗ, `selection` рж╣ржмрзЗ `null`ред

ЁЯОп ржПржЗ ржкржжрзНржзрждрж┐рждрзЗ `selection` рж╕рзНржмрж╛ржнрж╛ржмрж┐ржХржнрж╛ржмрзЗ ржЖржкржбрзЗржЯ рж╣рзЯ, ржПржмржВ ржЖржкржирж┐ ржмрж╛рзЬрждрж┐ ржЗржлрзЗржХрзНржЯ ржмрж╛ рж╕рзНржЯрзЗржЯ ржПржбржЬрж╛рж╕рзНржЯ ржХрж░рж╛рж░ ржЭрж╛ржорзЗрж▓рж╛ ржерзЗржХрзЗ ржмрзЗржБржЪрзЗ ржпрж╛ржиред
