# **State Structure ржарж┐ржХржнрж╛ржмрзЗ ржмрж╛ржЫрж╛ржЗ ржХрж░рж╛**

State ржЧржаржи ржнрж╛рж▓рзЛржнрж╛ржмрзЗ ржХрж░рж╛ ржорж╛ржирзЗ рж╣ржЪрзНржЫрзЗ component ржЯрж╛ржХрзЗ ржПржоржиржнрж╛ржмрзЗ рждрзИрж░рж┐ ржХрж░рж╛, ржпрж╛рждрзЗ ржПржЯрж╛ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржкрж░рж┐ржмрж░рзНрждржи ржмрж╛ debug ржХрж░рж╛ рж╕рж╣ржЬ рж╣рзЯред ржЖрж░ ржпржжрж┐ state ржарж┐ржХржнрж╛ржмрзЗ ржЧржарж┐ржд ржирж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржПржЯрж╛ bug ржПрж░ ржХрж╛рж░ржЦрж╛ржирж╛рзЯ ржкрж░рж┐ржгржд рж╣рждрзЗ ржкрж╛рж░рзЗред ржирж┐ржЪрзЗ ржХрж┐ржЫрзБ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржкрж░рж╛ржорж░рзНрж╢ ржжрзЗрзЯрж╛ рж╣рж▓рзЛ, ржпрзЗржЧрзБрж▓рзЛ ржорж╛ржерж╛рзЯ рж░рж╛ржЦрж╛ ржЙржЪрж┐ржд state ржЧржаржи ржХрж░рж╛рж░ рж╕ржорзЯред

ржПржЗ ржкрж╛ржарзЗ рж╢рж┐ржЦржмрзЗржи-

1. ржХржЦржи ржПржХрж╛ржзрж┐ржХ state variable ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржЙржЪрж┐ржд ржЖрж░ ржХржЦржи ржПржХржЯрж╛
2. state ржЧржаржирзЗрж░ рж╕ржорзЯ ржХрзЛржи ржнрзБрж▓ржЧрзБрж▓рзЛ ржПрзЬрж┐рзЯрзЗ ржЪрж▓рждрзЗ рж╣ржмрзЗ
3. рж╕рж╛ржзрж╛рж░ржг state ржЧржаржирзЗрж░ рж╕ржорж╕рзНржпрж╛ржЧрзБрж▓рзЛ ржХрж┐ржнрж╛ржмрзЗ ржарж┐ржХ ржХрж░рж╛ ржпрж╛рзЯ

---

## ЁЯз▒ State Structure ржПрж░ ржЬржирзНржп ржорзВрж▓ржирзАрждрж┐

рждрзБржорж┐ ржпржЦржи ржПржХржЯрж┐ component рж▓рж┐ржЦрзЛ ржпрзЗржЯрж╛рждрзЗ ржХрж┐ржЫрзБ state ржерж╛ржХржмрзЗ, рждржЦржи рждрзЛржорж╛ржХрзЗ рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирж┐рждрзЗ рж╣рзЯ:

- ржХрждржЧрзБрж▓рзЛ state variable ржерж╛ржХржмрзЗ?
- state-ржПрж░ ржбрзЗржЯрж╛ ржХрзЗржоржи ржЖржХрж╛рж░рзЗ ржерж╛ржХржмрзЗ?

рж╣рзНржпрж╛ржБ, state-ржПрж░ structure ржпржжрж┐ ржнрж╛рж▓рзЛ ржирж╛-ржУ рж╣рзЯ, рждржмрзБржУ technically рждрзЛржорж╛рж░ ржХрзЛржб ржХрж╛ржЬ ржХрж░ржмрзЗ тАФ ржХрж┐ржирзНрждрзБ bug рж╣ржУрзЯрж╛рж░ ржЭрзБржБржХрж┐ ржерж╛ржХржмрзЗ ржЕржирзЗржХ ржмрзЗрж╢рж┐ред

рждрж╛ржЗ ржирж┐ржЪрзЗрж░ ржХрж┐ржЫрзБ рж╕рж╣ржЬ ржЧрж╛ржЗржбрж▓рж╛ржЗржи ржоржирзЗ рж░рж╛ржЦрж▓рзЗ рждрзБржорж┐ ржЖрж░ржУ ржнрж╛рж▓рзЛ state structure ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ:

рззред рж╕ржорзНржкрж░рзНржХрж┐ржд state ржПржХрж╕рж╛ржерзЗ рж░рж╛ржЦрзЛ (Group related state together)
рзиред ржкрж░рж╕рзНржкрж░ ржмрж┐рж░рзЛржзрзА (contradictory) state ржПрзЬрж┐рзЯрзЗ ржЪрж▓рзЛ (Avoid contradictory state)
рзйред Redundant State рж░рж╛ржЦрзЛ ржирж╛ (ржмрж╛рзЬрждрж┐ рж╕рзНржЯрзЗржЯ ржПрзЬрж┐рзЯрзЗ ржЪрж▓рзЛ)
рзкред State-ржП ржПржХржЗ ржбрзЗржЯрж╛ ржмрж╛рж░ржмрж╛рж░ рж░рж╛ржЦрж╛ ржарж┐ржХ ржирж╛ (Avoid duplication)
рзлред Deeply nested state structure ржПрзЬрж┐рзЯрзЗ ржЪрж▓рзЛ (Avoid deeply nested state structure)

---

### ЁЯОп ржПржЗ ржирж┐рзЯржоржЧрзБрж▓рзЛрж░ ржЙржжрзНржжрзЗрж╢рзНржп

ржПржЗ ржЧрж╛ржЗржбрж▓рж╛ржЗржиржЧрзБрж▓рзЛрж░ ржЙржжрзНржжрзЗрж╢рзНржп рж╣рж▓рзЛ:

> **"state ржПржоржиржнрж╛ржмрзЗ ржЧржаржи ржХрж░рж╛ ржпрж╛рждрзЗ рж╕рзЗржЯрж╛ рж╕рж╣ржЬрзЗ update ржХрж░рж╛ ржпрж╛рзЯ, ржХрж┐ржирзНрждрзБ ржнрзБрж▓ ржирж╛ рж╣рзЯред"**

Redundant ржмрж╛ duplicate state remove ржХрж░рж▓рзЗ рж╕ржмржХрж┐ржЫрзБ sync ржерж╛ржХрзЗред ржПржЯрж╛ ржЕржирзЗржХржЯрж╛ ржбрзЗржЯрж╛ржмрзЗрж╕ normalizing ржХрж░рж╛рж░ ржорждрзЛ тАФ ржпрзЗржЦрж╛ржирзЗ ржЖржорж░рж╛ ржПржХржЗ рждржерзНржп ржПржХрж╛ржзрж┐ржХ ржЬрж╛рзЯржЧрж╛рзЯ ржирж╛ рж░рзЗржЦрзЗ centralized рж░рж╛ржЦрж┐ред

Albert Einstein ржмрж▓рзЗржЫрзЗржи,

> **"Make your state as simple as it can beтАФbut no simpler."**

ржорж╛ржирзЗ ржпрждржЯрж╛ рж╕ржорзНржнржм рж╕рж╣ржЬ рж░рж╛ржЦрзЛ, ржХрж┐ржирзНрждрзБ ржЕрждрж┐ рж╕рж░рж▓ ржХрж░рзЗ important logic рж╣рж╛рж░рж┐рзЯрзЗ ржлрзЗрж▓рзЛ ржирж╛ред

---

ржПржЦржи ржЖржорж░рж╛ ржжрзЗржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ ржПржЗ principle ржЧрзБрж▓рзЛ рж░рж┐рзЯрзЗрж▓ ржЙржжрж╛рж╣рж░ржгрзЗ ржХрж╛ржЬрзЗ рж▓рж╛ржЧрзЗред

### тЬЕ рзз. рж╕ржорзНржкрж░рзНржХрж┐ржд state ржПржХрж╕рж╛ржерзЗ рж░рж╛ржЦрзЛ

ржпржжрж┐ ржжрзЗржЦрзЛ ржжрзБржЗржЯрж╛ ржмрж╛ рждрж╛рж░ ржмрзЗрж╢рж┐ state рж╕ржмрж╕ржорзЯ ржПржХрж╕рж╛ржерзЗ update рж╣рзЯ, рждрж╛рж╣рж▓рзЗ рждрж╛ржжрзЗрж░ ржЖрж▓рж╛ржжрж╛ ржирж╛ рж░рзЗржЦрзЗ ржПржХржЯрж╛рзЯ merge ржХрж░рзЗ ржжрж╛ржУред

```js
// ржнрзБрж▓: ржЖрж▓рж╛ржжрж╛ рж╕рзНржЯрзЗржЯ
const [x, setX] = useState(0);
const [y, setY] = useState(0);

// ржнрж╛рж▓рзЛ: ржПржХрждрзНрж░рзЗ рж░рж╛ржЦрж╛
const [position, setPosition] = useState({ x: 0, y: 0 });
```

---

ржкрзНрж░рзЯрзЛржЬржирзЗ ржПржХрж╛ржзрж┐ржХ `useState` ржнрзЗржВржЧрзЗ ржПржХржЯрж┐ рж╕рж┐ржВржЧрзЗрж▓ state ржП рж░рж╛ржЦрзБржи/ ржЕржмржЬрзЗржХрзНржЯ/ array рж╣рж┐рж╕рзЗржмрзЗ рж░рж╛ржЦрзБржи

#### ржХржЦржи ржПржХрж╛ржзрж┐ржХ state рж░рж╛ржЦржмрзЛ, ржЖрж░ ржХржЦржи ржПржХржЯрж╛ржЗ ржпржерзЗрж╖рзНржЯ?

ржзрж░рзЛ, рждрзБржорж┐ `x` ржЖрж░ `y` position ржЯрзНрж░рзНржпрж╛ржХ ржХрж░рждрзЗ ржЪрж╛ржУред ржПржЦржи ржкрзНрж░рж╢рзНржи рж╣рж▓рзЛ, ржПржЗржнрж╛ржмрзЗ ржЖрж▓рж╛ржжрж╛ ржЖрж▓рж╛ржжрж╛ ржХрж░ржмрзЛ?

```js
const [x, setX] = useState(0);
const [y, setY] = useState(0);
```

ржирж╛ ржХрж┐ ржПржХрж╕рж╛ржерзЗржЗ рж░рж╛ржЦржмрзЛ?

```js
const [position, setPosition] = useState({ x: 0, y: 0 });
```

ЁЯСЙ **ржжрзБржЯрзЛржЗ technically ржарж┐ржХ**, ржХрж┐ржирзНрждрзБ ржпржжрж┐ ржжрзЗржЦрзЛ `x` ржЖрж░ `y` рж╕ржмрж╕ржорзЯ ржПржХрж╕рж╛ржерзЗ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржЪрзНржЫрзЗ тАФ рждрж╛рж╣рж▓рзЗ ржПржХржЯрж╛ржЗ рж╕рзНржЯрзЗржЯ рж░рж╛ржЦрж╛ ржнрж╛рж▓рзЛред ржПрждрзЗ ржХрж░рзЗ ржжрзБржЯрзЛржХрзЗ ржЖрж▓рж╛ржжрж╛ ржЖрж▓рж╛ржжрж╛ update ржХрж░рждрзЗ ржнрзБрж▓ рж╣ржмрж╛рж░ ржЪрж╛ржирзНрж╕ ржХржорзЗ ржпрж╛рзЯред

#### ржЙржжрж╛рж╣рж░ржг: ржорж╛ржЙрж╕ ржкрзЯрзЗржирзНржЯрж╛рж░ ржирзЬрж╛рж░ рж╕рж╛ржерзЗ рж╕рж╛ржерзЗ ржПржХржЯрж╛ рж▓рж╛рж▓ ржмрж▓ ржкржЬрж┐рж╢ржи ржЪрзЗржЮрзНржЬ ржХрж░рзЗ тАФ

```jsx
import { useState } from "react";

export default function MovingDot() {
  const [position, setPosition] = useState({ x: 0, y: 0 });

  return (
    <div
      onPointerMove={(e) => {
        setPosition({
          x: e.clientX,
          y: e.clientY,
        });
      }}
      style={{
        position: "relative",
        width: "100vw",
        height: "100vh",
      }}
    >
      <div
        style={{
          position: "absolute",
          backgroundColor: "red",
          borderRadius: "50%",
          transform: `translate(${position.x}px, ${position.y}px)`,
          left: -10,
          top: -10,
          width: 20,
          height: 20,
        }}
      />
    </div>
  );
}
```

---

#### ржХржЦржи object ржмрж╛ array рж╣рж┐рж╕рзЗржмрзЗ рж╕рзНржЯрзЗржЯ рж░рж╛ржЦржмрзЛ?

ржпржЦржи ржЬрж╛ржирзЛ ржирж╛ ржХрждржЧрзБрж▓рзЛ state рж▓рж╛ржЧржмрзЗ (ржпрзЗржоржи: ржбрж╛ржЗржирж╛ржорж┐ржХ form), рждржЦржи ржПржХржЯрж╛ object ржмрж╛ array рж╣рж┐рж╕рзЗржмрзЗ рж░рж╛ржЦрж╛ ржнрж╛рж▓рзЛред

---

#### тЪая╕П рж╕рж╛ржмржзрж╛ржирждрж╛:

ржпржжрж┐ state variable ржПржХржЯрж╛ object рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржПржХржЯрж╛ ржлрж┐рж▓рзНржб ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржЪрж╛ржЗрж▓рзЗ **ржмрж╛ржХрж┐ ржлрж┐рж▓рзНржбржЧрзБрж▓рзЛ ржХржкрж┐ ржХрж░рзЗ рж░рж╛ржЦрждрзЗ рж╣ржмрзЗ**ред ржирж┐ржЪрзЗрж░ржЯрж╛ ржнрзБрж▓:

```js
setPosition({ x: 100 }); // тЭМ y рж╣рж╛рж░рж┐рзЯрзЗ ржпрж╛ржмрзЗ
```

ржарж┐ржХ ржЙржкрж╛рзЯ рж╣рж▓рзЛ:

```js
setPosition({ ...position, x: 100 }); // тЬЕ y ржерж╛ржХржмрзЗ
```

ржЕржержмрж╛ `x`, `y` ржЖрж▓рж╛ржжрж╛ ржЖрж▓рж╛ржжрж╛ state ржХрж░рж▓рзЗ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ рж╕рзЗржЯ ржХрж░рж╛ ржпрж╛рзЯред

### тЪая╕П рзи. ржкрж░рж╕рзНржкрж░ ржмрж┐рж░рзЛржзрзА (contradictory) state ржПрзЬрж┐рзЯрзЗ ржЪрж▓рзЛ

ржпржжрж┐ рждрзЛржорж╛рж░ state ржПржоржиржнрж╛ржмрзЗ ржЧржарж┐ржд рж╣рзЯ ржпрзЗ, ржПржХржЯрж╛рж░ рж╕рж╛ржерзЗ ржЖрж░рзЗржХржЯрж╛рж░ ржорж╛ржи conflict ржХрж░рзЗ (ржорж╛ржирзЗ ржПржХрзЗ ржЕржкрж░рзЗрж░ рж╕рж╛ржерзЗ mismatch рж╣рзЯ), рждрж╛рж╣рж▓рзЗ bug ржЖрж╕рж╛рж░ ржЪрж╛ржирзНрж╕ ржмрзЗрж╢рж┐ред

ржЙржжрж╛рж╣рж░ржг:

```js
// ржЦрж╛рж░рж╛ржк
const [isLoggedIn, setIsLoggedIn] = useState(true);
const [user, setUser] = useState(null); // рждрж╛рж╣рж▓рзЗ ржЗржЙржЬрж╛рж░ ржХрзЛржерж╛рзЯ?
```

--- ржПржЯрж╛ ржПржХржЯрж╛ **impossible state** ржХрж╛рж░ржг рждрзБржорж┐ logged in ржЖржЫрзЛ ржХрж┐ржирзНрждрзБ ржЗржЙржЬрж╛рж░ ржирзЗржЗред ржПржЯрж╛ ржПржХржЯрж╛ contradictionред

ржзрж░рзЛ, рждрзБржорж┐ ржПржХржЯрж╛ hotel feedback form ржмрж╛ржирж╛рж▓рзЗ ржпрзЗржЦрж╛ржирзЗ ржжрзБржЯрж┐ state variable ржЖржЫрзЗ тАФ `isSending` ржЖрж░ `isSent`:

```js
const [isSending, setIsSending] = useState(false);
const [isSent, setIsSent] = useState(false);
```

ржПржЧрзБрж▓рзЛ ржжрж┐рзЯрзЗ рждрзБржорж┐ ржмрзЛржЭрж╛рждрзЗ ржЪрж╛ржУ: ржлрж░рзНржоржЯрж╛ ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛ (`isSending`) ржЖрж░ ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ ржХрж┐ржирж╛ (`isSent`)ред

#### ржХрж┐ржирзНрждрзБ рж╕ржорж╕рзНржпрж╛ ржХрзА?

ржпржжрж┐ ржнрзБрж▓рзЗ ржпрж╛ржУ ржХржЦржи `setIsSent(true)` ржЖрж░ ржХржЦржи `setIsSending(false)` ржжрж┐рждрзЗ рж╣ржмрзЗ тАФ рждрж╛рж╣рж▓рзЗ `isSending: true` ржЖрж░ `isSent: true` ржжрзБржЗржЯрж╛рзЯ ржПржХрж╕рж╛ржерзЗ true рж╣рзЯрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗ! ржПржЯрж╛ ржПржХржЯрж╛ **impossible state** ржХрж╛рж░ржг ржлрж░рзНржо ржХржЦржирзЛржЗ "ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗ" ржПржмржВ "ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ" тАФ ржПржЗ ржжрзБржЗ ржЕржмрж╕рзНржерж╛ ржПржХрж╕рж╛ржерзЗ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ ржирж╛ред

ржпрждрзЛ ржмрзЬ ржХржорзНржкрзЛржирзЗржирзНржЯ рж╣ржмрзЗ, ржПржЗ ржЯрж╛ржЗржкрзЗрж░ contradiction-tracking ржХрж░рж╛ рждрждрзЛ ржХрж╖рзНржЯржХрж░ред

---

#### тЬЕ рж╕рж▓рж┐ржЙрж╢ржи: ржПржХржЯрж╛ рж╕рзНржЯрзЗржЯржЗ рж░рж╛ржЦрзЛ `status` ржирж╛ржорзЗ

```js
const [status, setStatus] = useState("typing");
```

ржПржЗ `status` рж╕рзНржЯрзЗржЯ ржирж┐ржЪрзЗрж░ рзйржЯрж╛ ржЕржмрж╕рзНржерж╛ ржзрж░рзЗ рж░рж╛ржЦрждрзЗ ржкрж╛рж░ржмрзЗ:

- `'typing'` тЖТ ржЗржЙржЬрж╛рж░ рж▓рж┐ржЦрждрзЗржЫрзЗ
- `'sending'` тЖТ ржлрж░рзНржо рж╕рж╛ржмржорж┐ржЯ рж╣ржЗрждрзЗржЫрзЗ
- `'sent'` тЖТ ржлрж░рзНржо ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ

ржПрждрзЗ ржЕржмрж╕рзНржерж╛ ржЧрзБрж▓рж╛ рж╕рзНржкрж╖рзНржЯ ржерж╛ржХрзЗ ржЖрж░ ржнрзБрж▓ рж╣ржУрзЯрж╛рж░ ржЪрж╛ржирзНрж╕ржУ ржХржорзЗ ржпрж╛рзЯред

---

#### тЬи Updated Version:

```jsx
import { useState } from "react";

export default function FeedbackForm() {
  const [text, setText] = useState("");
  const [status, setStatus] = useState("typing");

  async function handleSubmit(e) {
    e.preventDefault();
    setStatus("sending");
    await sendMessage(text);
    setStatus("sent");
  }

  const isSending = status === "sending";
  const isSent = status === "sent";

  if (isSent) {
    return <h1>Thanks for feedback!</h1>;
  }

  return (
    <form onSubmit={handleSubmit}>
      <p>How was your stay at The Prancing Pony?</p>
      <textarea
        disabled={isSending}
        value={text}
        onChange={(e) => setText(e.target.value)}
      />
      <br />
      <button disabled={isSending} type="submit">
        Send
      </button>
      {isSending && <p>Sending...</p>}
    </form>
  );
}

function sendMessage(text) {
  return new Promise((resolve) => {
    setTimeout(resolve, 2000);
  });
}
```

---

#### тЬЕ ржЙржкржХрж╛рж░ ржХрзА?

- рж╕рзНржЯрзЗржЯржЧрзБрж▓рж╛ ржПржХрзЗ ржЕржкрж░рзЗрж░ рж╕рж╛ржерзЗ clash ржХрж░ржмрзЗ ржирж╛ред
- `isSending` ржЖрж░ `isSent` ржПржХрж╕рж╛ржерзЗ true рж╣ржмрж╛рж░ ржЪрж╛ржирзНрж╕ ржирж╛ржЗред
- ржХрзЛржбржЯрж╛ржУ ржмрзЗрж╢рж┐ readable, ржХржо ржмрж╛ржЧржкрзНрж░рзЛржиред

Einstein ржПрж░ ржХржерж╛ ржоржирзЗ рж░рзЗржЦрзЛ:

(ржЖржкржирж╛рж░ state ржпрждржЯрж╛ рж╕ржорзНржнржм рж╕рж░рж▓ рж░рж╛ржЦрзБржитАФржХрж┐ржирзНрждрзБ ржЕрждрж┐рж░рж┐ржХрзНржд рж╕рж░рж▓ ржирж╛ ржХрж░рзЗред)

ржнрж┐ржбрж┐ржУ рж▓рж┐ржВржХ: https://learnwithsumit.com/rnext/courses/rnext/choosing-the-state-structure-avoid-redundant-state

### тЩ╗я╕П рзй. Redundant State рж░рж╛ржЦрзЛ ржирж╛ (ржмрж╛рзЬрждрж┐ рж╕рзНржЯрзЗржЯ ржПржбрж┐рзЯрзЗ ржЪрж▓рзЛ)

ржпржжрж┐ ржХрзЛржирзЛ ржорж╛ржи component-ржПрж░ props ржмрж╛ ржЕржирзНржп state ржжрж┐рзЯрзЗржЗ рж╣рж┐рж╕рж╛ржм ржХрж░рж╛ ржпрж╛рзЯ, рждрж╛рж╣рж▓рзЗ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ state-ржП рж░рж╛ржЦрж╛рж░ ржжрж░ржХрж╛рж░ ржирж╛ржЗред

````js
// ржнрзБрж▓
const [firstName, setFirstName] = useState("");
const [lastName, setLastName] = useState("");
const [fullName, setFullName] = useState("");

// ржарж┐ржХ
const fullName = firstName + " " + lastName;
ржпржжрж┐ ржХрзЛржирзЛ рждржерзНржп component-ржПрж░ props ржмрж╛ state ржерзЗржХрзЗржЗ render-ржПрж░ рж╕ржорзЯ рж╣рж┐рж╕рзЗржм ржХрж░рзЗ ржлрзЗрж▓рж╛ ржпрж╛рзЯ, рждрж╛рж╣рж▓рзЗ рж╕рзЗржЯрж╛ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ state-ржП рж░рж╛ржЦрж╛ **ржкрзНрж░рзЯрзЛржЬржи ржирж╛ржЗ**ред

### ржЙржжрж╛рж╣рж░ржг:

```js
const [firstName, setFirstName] = useState("");
const [lastName, setLastName] = useState("");
const [fullName, setFullName] = useState("");
````

ржПржЦрж╛ржирзЗ `fullName` рж░рж┐ржбрж╛ржирзНржбрзНржпрж╛ржирзНржЯ ржХрж╛рж░ржг рждрзБржорж┐ ржПржЯрж╛ `firstName + ' ' + lastName` ржерзЗржХрзЗ ржкрзНрж░рждрж┐ render-ржП ржмрзЗрж░ ржХрж░рждрзЗ ржкрж╛рж░рзЛред

тЬЕ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж░рж▓рзЗ ржПржоржи рж╣ржмрзЗ:

```js
const fullName = firstName + " " + lastName;
```

ржПрждрзЗ `fullName` ржПрж░ ржЬржирзНржп state рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рждрзЗ рж╣рзЯ ржирж╛, ржмрж╛ржЧрзЗрж░ ржЪрж╛ржирзНрж╕ ржХржорзЗ, ржХрзЛржб рж╣рзЯ ржХрзНрж▓рж┐ржиред

---

#### тЪая╕П ржкрзНрж░ржкрж╕ржХрзЗ рж╕рзНржЯрзЗржЯрзЗ ржХржкрж┐ ржХрзЛрж░рзЛ ржирж╛

```js
const [color, setColor] = useState(messageColor); // тЭМ
```

ржПржЗржнрж╛ржмрзЗ ржкрзНрж░ржкрж╕ржХрзЗ рж╕рзНржЯрзЗржЯрзЗ ржХржкрж┐ ржХрж░рж▓рзЗ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржкрзНрж░ржкрж╕ ржЖржкржбрзЗржЯ рж╣рж▓рзЗржУ state ржЖржкржбрзЗржЯ рж╣ржмрзЗ ржирж╛ред

тЬЕ рж╕ржарж┐ржХ:

```js
const color = messageColor; // ЁЯСН
```

рждржмрзЗ, ржпржжрж┐ рж╢рзБржзрзБ ржкрзНрж░ржержоржмрж╛рж░рзЗрж░ ржЬржирзНржп ржкрзНрж░ржкрж╕ ржжрж░ржХрж╛рж░ рж╣рзЯ, рждржЦржи ржарж┐ржХ ржЖржЫрзЗ:

```js
const [color, setColor] = useState(initialColor); // тЬЕ
```

ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ ржмрзБржЭрж┐рзЯрзЗ ржжрж┐ржЪрзНржЫрж┐ future changes ignore ржХрж░ржмрзЛред

ржЕржмрж╢рзНржпржЗ, ржирж┐ржЪрзЗ ржЖржорж┐ ржкрзБрж░рзЛ ржмрзНржпрж╛ржЦрзНржпрж╛ржЯрж┐ржХрзЗ рж╕рзБржирзНржжрж░ржнрж╛ржмрзЗ ржПржХржЯрж┐ ржбржХрзБржорзЗржирзНржЯ ржЖржХрж╛рж░рзЗ ржмрж╛ржВрж▓рж╛ ржнрж╛рж╖рж╛ржпрж╝ ржЙржкрж╕рзНржерж╛ржкржи ржХрж░рж▓рж╛ржо, ржпрзЗржи рждрзБржорж┐ рж╕рж╣ржЬрзЗ ржкрзЬрждрзЗ ржмрж╛ ржЕржирзНржпржХрзЗ рж╢рзЗрзЯрж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЛред

#### тЭМ ржкрзНрж░ржкрж╕ржХрзЗ mirror ржХрж░рзЗ state ржмрж╛ржирж╛ржирзЛ ржпрж╛ржмрзЗ ржирж╛

ржирж┐ржЪрзЗрж░ ржХрзЛржбржЯрж╛ ржнрзБрж▓рзЗрж░ ржПржХржЯрж╛ ржЙржжрж╛рж╣рж░ржг:

```js
function Message({ messageColor }) {
  const [color, setColor] = useState(messageColor);
}
```

ржПржЦрж╛ржирзЗ state рж╣рж┐рж╕рзЗржмрзЗ `color` ржХрзЗ props ржерзЗржХрзЗ рж╕рзЗржЯ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред ржХрж┐ржирзНрждрзБ ржпржжрж┐ parent ржкрж░рзЗ prop ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ, state ржЖржкржбрзЗржЯ рж╣ржмрзЗ ржирж╛ред ржХрж╛рж░ржг `useState()` рж╢рзБржзрзБ ржкрзНрж░ржержо render ржП ржорж╛ржи ржирзЗржпрж╝ред

тЬЕ ржПрж░ ржмржжрж▓рзЗ рж╕рж░рж╛рж╕рж░рж┐ prop ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ:

```js
function Message({ messageColor }) {
  const color = messageColor;
}
```

---

#### ЁЯУЭ ржХржЦржи props ржерзЗржХрзЗ state ржмрж╛ржирж╛ржирзЛ ржпрж╛рзЯ?

ржпржЦржи рждрзБржорж┐ ржЪрж╛ржУ parent ржерзЗржХрзЗ ржирждрзБржи props ржПрж▓рзЗржУ рж╕рзЗржЯрж╛ ignore рж╣ржмрзЗ, рждржЦржи ржХрж░рж╛ ржпрж╛рзЯред рж╕рзЗржХрзНрж╖рзЗрждрзНрж░рзЗ prop ржПрж░ ржирж╛ржо convention ржорждрзЛ `initial` ржмрж╛ `default` ржжрж┐рзЯрзЗ рж╢рзБрж░рзБ ржХрж░рзЛ:

```js
function Message({ initialColor }) {
  const [color, setColor] = useState(initialColor);
}
```

ржПржЦрж╛ржирзЗ ржмрзЛржЭрж╛ржирзЛ рж╣ржЪрзНржЫрзЗ, `color` state рж╢рзБржзрзБржорж╛рждрзНрж░ ржкрзНрж░ржержо `initialColor` ржПрж░ ржорж╛ржи ржирж┐ржмрзЗ, ржкрж░ржмрж░рзНрждрзА ржЖржкржбрзЗржЯ ржЧрзБрж▓рж╛ ржЗржиржЧрзЛрж░ ржХрж░ржмрзЗред

---

#### ЁЯза рж╕рж╛рж░рж╛ржВрж╢

| ржнрж╛рж▓рзЛ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ тЬЕ                                    | ржЦрж╛рж░рж╛ржк ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ тЭМ                      |
| ----------------------------------------------------- | ---------------------------------------- |
| рж╣рж┐рж╕рж╛ржмржпрзЛржЧрзНржп ржорж╛ржиржЧрзБрж▓рзЛ render time ржП рж╣рж┐рж╕рж╛ржм ржХрж░рзЛ            | рж╣рж┐рж╕рж╛ржмржпрзЛржЧрзНржп ржорж╛ржиржХрзЗ state ржП рж░рж╛ржЦрзЛ ржирж╛         |
| ржкрзНрж░ржкрж╕ржХрзЗ рж╕рж░рж╛рж╕рж░рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ                            | ржкрзНрж░ржкрж╕ржХрзЗ mirror ржХрж░рзЗ state ржмрж╛ржирж┐ржУ ржирж╛        |
| `initialProp` ржирж╛ржорзЗ ржмрзБржЭрж┐рзЯрзЗ ржжрж╛ржУ future update ржжрж░ржХрж╛рж░ ржирж╛ржЗ | prop ржПрж░ ржирж╛ржо рж╕рж╛ржзрж╛рж░ржг рж░рж╛ржЦрж▓рзЗ ржнрзБрж▓ ржмрзЛржЭрж╛ржмрзБржЭрж┐ рж╣рзЯ |

---

**Bottom line:**  
ЁЯСЙ ржпрж╛ рж╣рж┐рж╕рж╛ржм ржХрж░рзЗ ржмрзЗрж░ ржХрж░рж╛ ржпрж╛рзЯ, рждрж╛ state-ржП рж░рзЗржЦрзЛ ржирж╛ред  
ЁЯСЙ ржкрзНрж░ржкрж╕ржХрзЗ ржХржЦржирзЛржЗ ржЕржХрж╛рж░ржгрзЗ рж╕рзНржЯрзЗржЯрзЗ ржХржкрж┐ ржХрзЛрж░рзЛ ржирж╛ред

### ЁЯЪл рзк. State-ржП ржПржХржЗ ржбрзЗржЯрж╛ ржмрж╛рж░ржмрж╛рж░ рж░рж╛ржЦрж╛ ржарж┐ржХ ржирж╛ (Avoid duplication)

ржПржХржЗ data ржпржжрж┐ ржПржХрж╛ржзрж┐ржХ ржЬрж╛рзЯржЧрж╛рзЯ рж░рж╛ржЦрж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржПржХ ржЬрж╛рзЯржЧрж╛ change ржХрж░рж▓рзЗ ржЕржирзНржп ржЬрж╛рзЯржЧрж╛рзЯ manually update ржХрж░рждрзЗ рж╣рзЯред ржПрждрзЗ mismatch ржмрж╛ bug ржЖрж╕рждрзЗ ржкрж╛рж░рзЗред

```js
// ржЦрж╛рж░рж╛ржк
const [user, setUser] = useState({ name: "Mojnu", email: "a@a.com" });
const [userName, setUserName] = useState("Mojnu"); // Duplication!

// ржнрж╛рж▓рзЛ
const userName = user.name;
```

ржПржЦрж╛ржирзЗ `userName` ржХрзЗ ржЖрж▓рж╛ржжрж╛ state рж╣рж┐рж╕рзЗржмрзЗ рж░рж╛ржЦрж╛рж░ ржжрж░ржХрж╛рж░ ржирж╛ржЗред рждрзБржорж┐ `user` object ржерзЗржХрзЗржЗ ржмрзЗрж░ ржХрж░рждрзЗ ржкрж╛рж░рзЛред

### ЁЯз▒ рзл. Deeply Nested State ржПрзЬрж┐рзЯрзЗ ржЪрж▓рзБржи тАФ ржХрзЗржи? ржХрж┐ржнрж╛ржмрзЗ?

React ржП ржпржЦржи ржЖржорж░рж╛ ржЕржирзЗржХ ржнрж┐рждрж░рзЗрж░ ржнрж┐рждрж░рзЗ ржбрзЗржЯрж╛ рж░рж╛ржЦрж┐, ржорж╛ржирзЗ nested object ржмрж╛ array тАФ рждржЦржи ржУржЗ ржбрзЗржЯрж╛ ржЖржкржбрзЗржЯ ржХрж░рж╛ ржЦрзБржм ржХржарж┐ржи рж╣рзЯрзЗ ржпрж╛рзЯред

ржпрзЗржоржи:

```js
// тЭМ ржЦрж╛рж░рж╛ржк
const [form, setForm] = useState({ user: { address: { city: "Dhaka" } } });
```

ржПржЗ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржП `city` ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржЧрзЗрж▓рзЗ ржкрзБрж░рж╛ object ржХржкрж┐ ржХрж░рзЗ ржХрж░рждрзЗ рж╣рзЯред

рждрж╛ржЗ рж╕ржмржЪрзЗрзЯрзЗ ржнрж╛рж▓рзЛ рж╣рзЯ ржпржжрж┐ ржирж┐ржЪрзЗрж░ ржорждрзЛ ржХрж░рзЗ ржлрзНрж▓рзНржпрж╛ржЯ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░рзЗ рж░рж╛ржЦрж┐:

```js
// тЬЕ ржнрж╛рж▓рзЛ
const [city, setCity] = useState("Dhaka");
```

---

#### ЁЯФН Nested structure ржП рж╕ржорж╕рзНржпрж╛ ржХрзЛржерж╛рзЯ?

ржзрж░рзБржи ржЖржкржирж┐ ржПржоржи ржПржХржЯрж╛ state рж░рзЗржЦрзЗржЫрзЗржи ржпрзЗржЦрж╛ржирзЗ "Botswana" ржЖржЫрзЗ ржПржЗржнрж╛ржмрзЗ:

`Root > Earth > Africa > Botswana`

ржПржЦржи ржпржжрж┐ ржЖржкржирж┐ рж╢рзБржзрзБ Botswana ржорзБржЫрждрзЗ ржЪрж╛ржи, рждрж╛рж╣рж▓рзЗ ржЖржкржирж╛ржХрзЗ Africa, Earth, ржПржоржиржХрж┐ Root ржЕржмрзНржжрж┐ржУ ржирждрзБржи ржХрж░рзЗ ржХржкрж┐ ржХрж░рзЗ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ рж╣ржмрзЗред ржорж╛ржирзЗ, ржПржХржЯрж╛ ржЫрзЛржЯ ржХрж╛ржЬрзЗрж░ ржЬржирзНржп ржЕржирзЗржХ рж▓рж╛ржЗржи ржХрзЛржб рж▓рж┐ржЦрждрзЗ рж╣рзЯред

ржПржЯрж╛ржЗ Nested State ржПрж░ рж╕ржорж╕рзНржпрж╛рж░ ржорзВрж▓ ржХрж╛рж░ржгред

---

#### тЬЕ рж╕ржорж╛ржзрж╛ржи: ржлрзНрж▓рзНржпрж╛ржЯ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ (Flat Structure)

ржЖржорж░рж╛ ржпржжрж┐ ржкрзНрж░рждрж┐ржЯрж┐ ржЬрж╛рзЯржЧрж╛ржХрзЗ ржЖрж▓рж╛ржжрж╛ object рж╣рж┐рж╕рзЗржмрзЗ рж░рж╛ржЦрж┐ ржПржмржВ рждрж╛рж░ childIds ржЖрж▓рж╛ржжрж╛ржнрж╛ржмрзЗ рж░рж╛ржЦрж┐, рждрж╛рж╣рж▓рзЗ:

- ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╕рж╣ржЬ рж╣рзЯ
- delete ржмрж╛ find ржХрж░рж╛ржУ рж╕рж╣ржЬ рж╣рзЯ
- performance ржнрж╛рж▓рзЛ ржерж╛ржХрзЗ
- ржХржорзНржкрзЛржирзЗржирзНржЯ ржЧрзБрж▓рзЛржУ ржкрж░рж┐рж╖рзНржХрж╛рж░ рж╣рзЯ

> ржПржЯрж╛ ржЕржирзЗржХржЯрж╛ Database ржЯрзЗржмрж┐рж▓рзЗрж░ ржорждрзЛ тАФ ржпрзЗржЦрж╛ржирзЗ ржкрзНрж░рждрж┐ржЯрж╛ row ржЖрж▓рж╛ржжрж╛ ID ржжрж┐рзЯрзЗ ржЪрзЗржирж╛ ржпрж╛рзЯред

---

### тЭМ Nested structure (ржХрзНрж▓рж╛рж╕рж┐ржХ ржкржжрзНржзрждрж┐)

```js
const places = {
  id: 0,
  title: "(Root)",
  childPlaces: [
    {
      id: 1,
      title: "Earth",
      childPlaces: [
        {
          id: 2,
          title: "Africa",
          childPlaces: [
            {
              id: 3,
              title: "Botswana",
              childPlaces: [],
            },
          ],
        },
      ],
    },
  ],
};
```

ржПржЦрж╛ржирзЗ Botswana ржЦрзБржБржЬрзЗ ржкрзЗрждрзЗ ржЧрзЗрж▓рзЗ ржЕржирзЗржХ ржзрж╛ржк ржкрзЗрж░рзЛрждрзЗ рж╣рзЯред

---

#### тЬЕ ржлрзНрж▓рзНржпрж╛ржЯ structure (ржжрж╛рж░рзБржи рж╕рж╣ржЬ)

```js
{
  0: {
    id: 0,
    title: '(Root)',
    childIds: [1]
  },
  1: {
    id: 1,
    title: 'Earth',
    childIds: [2]
  },
  2: {
    id: 2,
    title: 'Africa',
    childIds: [3]
  },
  3: {
    id: 3,
    title: 'Botswana',
    childIds: []
  },
}
```

ржПржЦрж╛ржирзЗ рж╢рзБржзрзБ ID ржжрж┐рж▓рзЗржЗ ржЖржкржирж┐ ржпрзЗржХрзЛржирзЛ ржЬрж╛рзЯржЧрж╛рзЯ ржкрзМржБржЫрзЗ ржпрзЗрждрзЗ ржкрж╛рж░ржмрзЗржи: `placesById[3]`

---

#### ЁЯОБ ржлрзНрж▓рзНржпрж╛ржЯ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░рзЗрж░ рж╕рзБржмрж┐ржзрж╛:

- ржХрзЛржирзЛ ржкрзНрж▓рзЗрж╕ ржЦрзБржБржЬрждрзЗ ржмрж╛ ржорзБржЫрждрзЗ ID ржЗ ржпржерзЗрж╖рзНржЯ
- ржХржо ржХрзЛржбрзЗ ржЕржирзЗржХ ржХрж╛ржЬ рж╣рзЯ
- ржмрзЬ ржбрзЗржЯрж╛ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рж╛ржУ рж╕рж╣ржЬ
- ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржирзЗржХ ржнрж╛рж▓рзЛ

---

#### ЁЯзй Component Breakdown

`PlaceTree` Component

```jsx
function PlaceTree({ id, placesById }) {
  const place = placesById[id];
  const childIds = place.childIds;

  return (
    <li>
      {place.title}
      {childIds.length > 0 && (
        <ol>
          {childIds.map((childId) => (
            <PlaceTree key={childId} id={childId} placesById={placesById} />
          ))}
        </ol>
      )}
    </li>
  );
}
```

ЁЯУМ ржПржЯрж╛ ржПржХржЯрж╛ recursive component тАФ ржорж╛ржирзЗ ржирж┐ржЬрзЗржЗ ржирж┐ржЬрзЗржХрзЗ ржХрж▓ ржХрж░рзЗ nested child ржЧрзБрж▓рзЛ ржжрзЗржЦрж╛рзЯред

---

#### `TravelPlan` Component

```jsx
export default function TravelPlan() {
  const [plan, setPlan] = useState(initialTravelPlan);
  const root = plan[0];
  const planetIds = root.childIds;

  return (
    <>
      <h2>Places to visit</h2>
      <ol>
        {planetIds.map((id) => (
          <PlaceTree key={id} id={id} placesById={plan} />
        ))}
      </ol>
    </>
  );
}
```

ЁЯУМ ржПржЦрж╛ржирзЗ ржорзВрж▓ state рж░рж╛ржЦрж╛ рж╣рзЯрзЗржЫрзЗ `plan` ржирж╛ржорзЗ тАФ ржпрзЗржЯрж╛ рж╣ржЪрзНржЫрзЗ ржПржХржЯрж╛ ржлрзНрж▓рзНржпрж╛ржЯ object ржпрзЗржЦрж╛ржирзЗ ржкрзНрж░рждрж┐ржЯрж╛ ржкрзНрж▓рзЗрж╕ ржЖрж▓рж╛ржжрж╛ key рж╣рж┐рж╕рзЗржмрзЗ ржЖржЫрзЗред

---

#### ЁЯУВ initialTravelPlan (ржбрзЗржЯрж╛рж░ structure)

```js
export const initialTravelPlan = {
  0: {
    id: 0,
    title: "(Root)",
    childIds: [1, 42, 46],
  },
  1: {
    id: 1,
    title: "Earth",
    childIds: [2, 10, 19, 26, 34],
  },
  2: {
    id: 2,
    title: "Africa",
    childIds: [3, 4, 5, 6, 7, 8, 9],
  },
};
```

ЁЯУМ ржкрзНрж░рждрж┐ржЯрж╛ ржЬрж┐ржирж┐рж╕ ржЖрж▓рж╛ржжрж╛ key, ржЖрж░ рждрж╛рж░ ржЕржзрзАржирзЗ childIds ржП child id ржЧрзБрж▓рзЛ рж░рж╛ржЦрж╛ рж╣рзЯрзЗржЫрзЗред

---

#### ЁЯзк ржЙржкрж╕ржВрж╣рж╛рж░

**Flat structure ржХрзЗржи ржмрзЗрж╕рзНржЯ?**

- ржЖржкржбрзЗржЯ, ржЦрзЛржБржЬрж╛, ржмрж╛ ржбрж┐рж▓рж┐ржЯ рж╕ржм рж╕рж╣ржЬ рж╣рзЯ
- ржмрзЬ ржбрзЗржЯрж╛ржУ efficiently manage ржХрж░рж╛ ржпрж╛рзЯ
- ржХржорзНржкрзЛржирзЗржирзНржЯ clean ржУ readable рж╣рзЯ
- ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржирзЗржХ ржЙржирзНржиржд рж╣рзЯ

---

## ЁЯФз Bonus: Memory ржЕржкржЯрж┐ржорж╛ржЗржЬ + Immer ржжрж┐рзЯрзЗ smart update

Immer рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржжрж┐рзЯрзЗ ржЖржорж░рж╛ state ржЗржорж┐ржЙржЯрзЗржмрж▓ рж░рзЗржЦрзЗ ржЕржирзЗржХ рж╕рж╣ржЬрзЗ update ржХрж░рждрзЗ ржкрж╛рж░рж┐ред ржирж┐ржЪрзЗ ржПржХржЯрж╛ example:

```js
import { useImmer } from "use-immer";

const [plan, updatePlan] = useImmer(initialTravelPlan);

function handleComplete(parentId, childId) {
  updatePlan((draft) => {
    const parent = draft[parentId];
    parent.childIds = parent.childIds.filter((id) => id !== childId);

    deleteAllChildren(childId);
    function deleteAllChildren(id) {
      const place = draft[id];
      place.childIds.forEach(deleteAllChildren);
      delete draft[id];
    }
  });
}
```

ЁЯСЙ ржПржЦрж╛ржирзЗ `handleComplete()` ржХрж▓ ржХрж░рж▓рзЗ рж╢рзБржзрзБ UI ржирж╛ тАФ ржорзЗржорзЛрж░рж┐рждрзЗржУ рж╕рзЗржЗ ржкрзНрж▓рзЗрж╕ ржкрзБрж░рзЛржкрзБрж░рж┐ delete рж╣рзЯрзЗ ржпрж╛рзЯред  
ЁЯСЙ ржПржЗржнрж╛ржмрзЗ ржЖржорж╛ржжрзЗрж░ ржЕрзНржпрж╛ржк рж╕рзНржорж╛рж░рзНржЯржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ, memory leak рж╣рзЯ ржирж╛ред

---

**ржПржХ ржХржерж╛рзЯ:**  
Nested state ржорж╛ржирзЗржЗ ржЭрж╛ржорзЗрж▓рж╛ред  
Flat state ржорж╛ржирзЗржЗ рж╕рзБржирзНржжрж░, рж╕рж╣ржЬ, рж╕рзНржорж╛рж░рзНржЯ ржХрзЛржбред
